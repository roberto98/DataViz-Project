<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Loading GeoJSON data and generating SVG paths</title>
		<script type="text/javascript" src="../d3.js"></script>
		<style type="text/css">
		</style>
	</head>
	<body>
<svg id="my_dataviz" width="400" height="300"></svg>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script type="text/javascript">

	var svg = d3.select("svg"),
		width = +svg.attr("width"),
		height = +svg.attr("height");

	var projection = d3.geoMercator()
		.scale(70)
		.center([0,20])
		.translate([width / 2, height / 2]);

	var color = d3.scaleQuantize()
		.range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);
	
	d3.csv("kaggle_dataset.csv",function(data){
		var targetYear = "2015";
		var targetCol = "Alcohol";
		var data = data.filter(function(d){return d.Year==targetYear})
		console.log(data);


		var allValues = []
		d3.json("world.json", function(json){
			for (var i = 0; i < data.length; i++) {
				var dataCountry = data[i].Country;
				console.log(data[i][targetCol])
				var dataValue = parseFloat(data[i][targetCol]);

				for (var j = 0; j < json.features.length; j++) {
					var jsonCountry = json.features[j].properties.name;
					if (dataCountry == jsonCountry) {
						console.log(dataValue)
						json.features[j].properties.value = dataValue;
						allValues.push(dataValue);
						break;
					}
				}
			}
			color.domain([d3.min(allValues), d3.max(allValues)]);

			svg.selectAll("path")
				.data(json.features)
				.enter()
				.append("path")
				.attr("d", d3.geoPath().projection(projection))
				.style("fill", function(d){
					var value = d.properties.value;
					if (value)
						return color(value);
					else
						return "#ccc";
				})

		})
	})

</script>
</body>
</html>